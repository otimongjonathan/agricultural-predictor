<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .calculation-breakdown {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .cost-details {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 5px;
        }
        .trend-up { color: #dc3545; }
        .trend-down { color: #28a745; }
        .breakdown-table { font-size: 0.8rem; }
        .operational-explanation {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 10px 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h3>Prediction Results</h3>
                    </div>
                    <div class="card-body">
                        <h5>Location & Crop Details</h5>
                        <p><strong>Region:</strong> {{ region }} | <strong>District:</strong> {{ district }} | <strong>Crop:</strong> {{ crop }}</p>
                        
                        <div class="operational-explanation">
                            <strong>ðŸ’¡ Operational Costs Breakdown for {{ region }} Region:</strong><br>
                            Includes transportation, storage, equipment maintenance, administrative costs, and other overhead expenses.
                        </div>
                        
                        <div class="calculation-breakdown">
                            <h6>Initial Input Prices (Per Unit):</h6>
                            <div class="row">
                                <div class="col-md-2"><strong>Seed:</strong> {{ "{:,.0f}".format(current_prices.seed_price) }} UGX/kg</div>
                                <div class="col-md-2"><strong>Fertilizer:</strong> {{ "{:,.0f}".format(current_prices.fertilizer_price) }} UGX/kg</div>
                                <div class="col-md-2"><strong>Herbicide:</strong> {{ "{:,.0f}".format(current_prices.herbicide_price) }} UGX/litre</div>
                                <div class="col-md-2"><strong>Pesticide:</strong> {{ "{:,.0f}".format(current_prices.pesticide_price) }} UGX/litre</div>
                                <div class="col-md-2"><strong>Labor:</strong> {{ "{:,.0f}".format(current_prices.labor_cost) }} UGX/day</div>
                            </div>
                        </div>
                        
                        <h5 class="mt-4">Predicted Total Input Costs (Per Acre)</h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Month</th>
                                        <th>Predicted Cost</th>
                                        <th>Price Change</th>
                                        <th>Calculation Breakdown</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for prediction in predictions %}
                                    <tr>
                                        <td><strong>{{ prediction.month }}</strong></td>
                                        <td><strong class="fs-5">{{ "{:,.0f}".format(prediction.predicted_cost) }}</strong> UGX</td>
                                        <td>
                                            {% if prediction.percentage_change > 0 %}
                                                <span class="trend-up">+{{ prediction.percentage_change }}%</span>
                                            {% else %}
                                                <span class="trend-down">{{ prediction.percentage_change }}%</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="cost-details">
                                                <strong>Input Costs:</strong><br>
                                                <table class="table table-sm breakdown-table">
                                                    <tr>
                                                        <td>Seed:</td>
                                                        <td>{{ "{:,.0f}".format(prediction.base_costs.seed_price.unit_price) }} Ã— {{ prediction.base_costs.seed_price.quantity }}</td>
                                                        <td>= {{ "{:,.0f}".format(prediction.base_costs.seed_price.total_cost) }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Fertilizer:</td>
                                                        <td>{{ "{:,.0f}".format(prediction.base_costs.fertilizer_price.unit_price) }} Ã— {{ prediction.base_costs.fertilizer_price.quantity }}</td>
                                                        <td>= {{ "{:,.0f}".format(prediction.base_costs.fertilizer_price.total_cost) }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Herbicide:</td>
                                                        <td>{{ "{:,.0f}".format(prediction.base_costs.herbicide_price.unit_price) }} Ã— {{ prediction.base_costs.herbicide_price.quantity }}</td>
                                                        <td>= {{ "{:,.0f}".format(prediction.base_costs.herbicide_price.total_cost) }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Pesticide:</td>
                                                        <td>{{ "{:,.0f}".format(prediction.base_costs.pesticide_price.unit_price) }} Ã— {{ prediction.base_costs.pesticide_price.quantity }}</td>
                                                        <td>= {{ "{:,.0f}".format(prediction.base_costs.pesticide_price.total_cost) }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Labor:</td>
                                                        <td>{{ "{:,.0f}".format(prediction.base_costs.labor_cost.unit_price) }} Ã— {{ prediction.base_costs.labor_cost.quantity }}</td>
                                                        <td>= {{ "{:,.0f}".format(prediction.base_costs.labor_cost.total_cost) }}</td>
                                                    </tr>
                                                    <tr class="table-secondary">
                                                        <td><strong>Subtotal:</strong></td>
                                                        <td></td>
                                                        <td><strong>{{ "{:,.0f}".format(prediction.total_base_cost) }}</strong></td>
                                                    </tr>
                                                    <tr>
                                                        <td>+ Seasonal ({{ prediction.calculation_details.seasonal_factor }}Ã—):</td>
                                                        <td></td>
                                                        <td>{{ "{:,.0f}".format(prediction.seasonal_adjusted_cost) }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>+ Operational ({{ (prediction.calculation_details.operational_factor * 100)|round }}%):</td>
                                                        <td></td>
                                                        <td>+{{ "{:,.0f}".format(prediction.operational_costs) }}</td>
                                                    </tr>
                                                    <tr class="table-success">
                                                        <td><strong>Total:</strong></td>
                                                        <td></td>
                                                        <td><strong>{{ "{:,.0f}".format(prediction.predicted_cost) }}</strong></td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="alert alert-info mt-4">
                            <h6>Calculation Methodology:</h6>
                            <ul class="mb-0">
                                <li><strong>Input Quantities:</strong> Based on realistic usage per acre for each crop type</li>
                                <li><strong>Price Projection:</strong> Monthly inflation applied to unit prices</li>
                                <li><strong>Seasonal Factors:</strong> Demand variations throughout the year</li>
                                <li><strong>Operational Costs:</strong> Transport, storage, equipment (varies by region)</li>
                                <li><strong>Market Variations:</strong> Small random fluctuations (Â±3%)</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <a href="/" class="btn btn-primary">Make Another Prediction</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>